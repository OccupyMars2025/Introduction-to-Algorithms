## with the first pass, construct d count arrays in advance